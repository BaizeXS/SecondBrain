# 文件/笔记上传功能

## 功能概述

在右侧边栏的文件和笔记界面中添加了上传功能，允许用户选择文件/笔记并添加到聊天框中。这个功能类似于点击聊天框中的回形针附件功能。

## 主要特性

### 1. 上传图标
- 在右侧边栏的Files和Notes标签页中，搜索和筛选按钮旁边添加了上传图标（📤）
- 点击上传图标进入选择模式

### 2. 选择模式
- 点击上传图标后，每个文件/笔记前面会出现复选框
- 用户可以选择多个文件/笔记
- 选中的项目会有视觉反馈（蓝色边框和背景）

### 3. 确认按钮
- 当有项目被选中时，在右侧边栏右下角显示确认按钮
- 显示选中项目的数量
- 点击"Add to Chat"按钮将选中的项目添加到聊天框

### 4. 聊天框集成
- 选中的文件/笔记会显示在聊天输入框上方的预览区域
- 文件显示为蓝色背景，笔记显示为黄色背景
- 可以单独移除每个项目
- 发送消息时，选中的项目会作为附件一起发送
- **修复**：发送消息后，输入框中的文件/笔记会自动清空

### 5. 聊天区域显示
- **修复**：聊天区域现在可以正确显示笔记附件
- 笔记附件显示为黄色背景，带有编辑图标
- 文件附件显示为蓝色背景，带有文件图标

## 技术实现

### 1. 全局状态管理
- 创建了`ChatContext`来管理从侧边栏选择的文件/笔记
- 提供了添加、移除、清空选择等功能

### 2. 组件更新
- `FilesListView`和`NotesListView`：添加选择模式和相关UI
- `ChatInputInterface`：集成侧边栏选择的项目，发送后自动清空
- `MessageFileAttachments`：支持显示笔记附件
- `HomePage`和`ProjectPage`：更新消息处理函数支持笔记参数

### 3. 样式设计
- 选择模式下的复选框样式
- 选中项目的视觉反馈
- 确认按钮的样式
- 笔记预览卡片的特殊样式（黄色背景）
- 笔记附件的特殊样式（黄色背景，橙色图标）

## 使用方法

1. **进入选择模式**：在右侧边栏的Files或Notes标签页中，点击上传图标
2. **选择项目**：勾选想要添加到聊天框的文件或笔记
3. **确认选择**：点击右下角的"Add to Chat"按钮
4. **发送消息**：在聊天框中输入消息，选中的项目会作为附件一起发送
5. **自动清空**：发送消息后，输入框中的文件/笔记会自动清空

## 数据流

```
右侧边栏选择 → ChatContext → ChatInputInterface → 消息发送 → 自动清空
```

1. 用户在右侧边栏选择文件/笔记
2. 通过`ChatContext`管理选择状态
3. `ChatInputInterface`显示选中的项目
4. 发送消息时，选中的项目作为附件一起发送
5. 发送后自动清空所有选中的项目

## 文件结构

### 新增文件
- `src/contexts/ChatContext.js`：聊天相关的全局状态管理

### 修改文件
- `src/components/layout/RightSidebar.js`：添加选择模式和上传功能
- `src/components/layout/RightSidebar.module.css`：添加选择模式样式
- `src/components/chat/ChatInputInterface.js`：集成侧边栏选择的项目，发送后自动清空
- `src/components/chat/ChatInputInterface.module.css`：添加笔记预览样式
- `src/components/chat/MessageFileAttachments.js`：支持显示笔记附件
- `src/components/chat/MessageFileAttachments.module.css`：添加笔记附件样式
- `src/pages/HomePage.js`：更新消息处理函数和显示逻辑
- `src/pages/ProjectPage.js`：更新消息处理函数和显示逻辑
- `src/App.js`：添加ChatProvider

## 样式特点

### 选择模式
- 复选框：16x16px，位于项目左侧
- 选中项目：蓝色边框和背景
- 确认按钮：固定在右下角，带阴影效果

### 预览区域
- 文件：蓝色背景，文件图标
- 笔记：黄色背景，编辑图标
- 移除按钮：悬停时显示

### 聊天区域附件
- 文件：蓝色背景，文件图标
- 笔记：黄色背景，编辑图标
- 支持折叠/展开功能

## 修复的问题

### 1. 发送后自动清空
- **问题**：发送消息后，输入框中的文件/笔记依然存在
- **修复**：在`ChatInputInterface`中添加`clearChatSelections()`调用，发送后自动清空所有选中的项目

### 2. 聊天区域显示笔记
- **问题**：聊天区域不显示笔记附件
- **修复**：
  - 更新`MessageFileAttachments`组件支持笔记参数
  - 更新`HomePage`、`ProjectPage`和`RightSidebar`中的消息显示逻辑
  - 添加笔记附件的CSS样式（黄色背景，橙色图标）

## 注意事项

1. **去重机制**：系统会自动去重，避免重复添加相同的文件/笔记
2. **状态同步**：选择状态在退出选择模式时会自动清空
3. **自动清空**：发送消息后，所有选中的项目会自动清空
4. **响应式设计**：确认按钮在移动设备上也能正常显示
5. **无障碍支持**：所有交互元素都有适当的aria标签

## 未来扩展

1. **批量操作**：支持全选/取消全选
2. **拖拽支持**：支持拖拽文件到聊天框
3. **预览功能**：支持预览选中的文件内容
4. **权限控制**：根据用户权限限制可选择的文件/笔记
5. **附件管理**：支持在聊天历史中查看和管理附件 