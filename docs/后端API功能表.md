# 📚 SecondBrain 后端API功能表

## 🔐 认证模块 (/api/v1/auth)

| 功能         | 方法 | 路径                    | 描述                           |
| :----------- | :--- | :---------------------- | :----------------------------- |
| 用户注册     | POST | /register               | 用户账户注册，包含密码强度验证 |
| 用户登录     | POST | /login                  | OAuth2形式登录                 |
| JSON登录     | POST | /login/json             | JSON格式登录接口               |
| 刷新令牌     | POST | /refresh                | 刷新访问令牌                   |
| 用户登出     | POST | /logout                 | 用户登出（客户端删除令牌）     |
| 修改密码     | POST | /change-password        | 修改当前用户密码               |
| 重置密码请求 | POST | /reset-password         | 发起密码重置请求               |
| 确认重置密码 | POST | /reset-password/confirm | 确认重置密码                   |

## 👤 用户管理 (/api/v1/users)

| 功能             | 方法   | 路径                | 描述                       |
| :--------------- | :----- | :------------------ | :------------------------- |
| 获取当前用户信息 | GET    | /me                 | 获取当前登录用户的详细信息 |
| 更新当前用户     | PUT    | /me                 | 更新当前用户的个人信息     |
| 修改密码         | POST   | /me/change-password | 修改用户密码               |
| 用户统计信息     | GET    | /me/stats           | 获取用户的使用统计数据     |
| 删除账户         | DELETE | /me                 | 删除用户账户（需密码确认） |

## 💬 聊天对话 (/api/v1/chat)

### 模型管理

| 功能         | 方法 | 路径    | 描述                     |
| :----------- | :--- | :------ | :----------------------- |
| 获取可用模型 | GET  | /models | 获取所有可用的AI模型列表 |

### OpenAI兼容接口

| 功能     | 方法 | 路径         | 描述                             |
| :------- | :--- | :----------- | :------------------------------- |
| 聊天完成 | POST | /completions | 创建聊天完成（支持流式和非流式） |

### 对话管理

| 功能         | 方法   | 路径                             | 描述                 |
| :----------- | :----- | :------------------------------- | :------------------- |
| 创建对话     | POST   | /conversations                   | 创建新的对话会话     |
| 获取对话列表 | GET    | /conversations                   | 获取用户的对话列表   |
| 获取对话详情 | GET    | /conversations/{conversation_id} | 获取特定对话及其消息 |
| 更新对话     | PUT    | /conversations/{conversation_id} | 更新对话信息         |
| 删除对话     | DELETE | /conversations/{conversation_id} | 删除对话             |

### 消息管理

| 功能         | 方法 | 路径                                                         | 描述                     |
| :----------- | :--- | :----------------------------------------------------------- | :----------------------- |
| 发送消息     | POST | /conversations/{conversation_id}/messages                    | 发送消息（支持多模态）   |
| 重新生成消息 | POST | /conversations/{conversation_id}/messages/{message_id}/regenerate | 重新生成AI响应           |
| 分析附件     | POST | /analyze-attachments                                         | 分析上传附件的类型和需求 |

### 分支管理

| 功能     | 方法   | 路径                                                    | 描述               |
| :------- | :----- | :------------------------------------------------------ | :----------------- |
| 创建分支 | POST   | /conversations/{conversation_id}/branches               | 在对话中创建新分支 |
| 列出分支 | GET    | /conversations/{conversation_id}/branches               | 列出对话的所有分支 |
| 切换分支 | POST   | /conversations/{conversation_id}/branches/switch        | 切换到指定分支     |
| 分支历史 | GET    | /conversations/{conversation_id}/branches/history       | 获取分支历史树     |
| 合并分支 | POST   | /conversations/{conversation_id}/branches/merge         | 合并分支           |
| 删除分支 | DELETE | /conversations/{conversation_id}/branches/{branch_name} | 删除分支           |

## 📁 文档管理 (/api/v1/documents)

### 文档CRUD

| 功能         | 方法   | 路径           | 描述                     |
| :----------- | :----- | :------------- | :----------------------- |
| 上传文档     | POST   | /upload        | 上传文档到知识空间       |
| 获取文档列表 | GET    | /              | 获取文档列表（支持筛选） |
| 获取文档详情 | GET    | /{document_id} | 获取特定文档的详细信息   |
| 更新文档     | PUT    | /{document_id} | 更新文档信息             |
| 删除文档     | DELETE | /{document_id} | 删除文档                 |

### 文档内容

| 功能         | 方法 | 路径                    | 描述                     |
| :----------- | :--- | :---------------------- | :----------------------- |
| 下载文档     | POST | /{document_id}/download | 下载文档文件             |
| 文档预览     | GET  | /{document_id}/preview  | 获取文档预览内容         |
| 获取文档内容 | GET  | /{document_id}/content  | 获取文档文本内容（分页） |

### 网页导入

| 功能         | 方法 | 路径                    | 描述                  |
| :----------- | :--- | :---------------------- | :-------------------- |
| 导入网页     | POST | /import-url             | 从URL导入网页内容     |
| 批量导入网页 | POST | /batch-import-urls      | 批量从URL导入内容     |
| 获取网页快照 | GET  | /{document_id}/snapshot | 获取网页文档的快照    |
| 分析URL      | POST | /analyze-url            | 分析URL内容（不保存） |

### 搜索

| 功能     | 方法 | 路径    | 描述             |
| :------- | :--- | :------ | :--------------- |
| 搜索文档 | POST | /search | 在文档中进行搜索 |

## 🏠 空间管理 (/api/v1/spaces)

| 功能         | 方法   | 路径        | 描述               |
| :----------- | :----- | :---------- | :----------------- |
| 创建空间     | POST   | /           | 创建新的知识空间   |
| 获取空间列表 | GET    | /           | 获取用户的空间列表 |
| 获取空间详情 | GET    | /{space_id} | 获取空间详细信息   |
| 更新空间     | PUT    | /{space_id} | 更新空间信息       |
| 删除空间     | DELETE | /{space_id} | 删除空间           |

## 📝 笔记管理 (/api/v1/notes)

### 笔记CRUD

| 功能         | 方法   | 路径       | 描述                     |
| :----------- | :----- | :--------- | :----------------------- |
| 获取笔记列表 | GET    | /          | 获取笔记列表（支持筛选） |
| 获取最近笔记 | GET    | /recent    | 获取最近编辑的笔记       |
| 搜索笔记     | POST   | /search    | 搜索笔记内容             |
| 获取笔记详情 | GET    | /{note_id} | 获取笔记详细信息         |
| 创建笔记     | POST   | /          | 创建新笔记               |
| 更新笔记     | PUT    | /{note_id} | 更新笔记内容             |
| 删除笔记     | DELETE | /{note_id} | 删除笔记                 |

### AI功能

| 功能       | 方法 | 路径         | 描述               |
| :--------- | :--- | :----------- | :----------------- |
| AI生成笔记 | POST | /ai/generate | 使用AI生成笔记内容 |
| AI文档总结 | POST | /ai/summary  | 创建AI文档总结     |

### 笔记关联

| 功能         | 方法 | 路径              | 描述           |
| :----------- | :--- | :---------------- | :------------- |
| 获取关联笔记 | GET  | /{note_id}/linked | 获取关联的笔记 |

### 标签管理

| 功能         | 方法   | 路径            | 描述                   |
| :----------- | :----- | :-------------- | :--------------------- |
| 添加标签     | POST   | /{note_id}/tags | 为笔记添加标签         |
| 移除标签     | DELETE | /{note_id}/tags | 移除笔记标签           |
| 获取所有标签 | GET    | /tags/all       | 获取所有标签及使用次数 |

### 批量操作

| 功能     | 方法 | 路径   | 描述                             |
| :------- | :--- | :----- | :------------------------------- |
| 批量操作 | POST | /batch | 批量操作笔记（删除、移动、标签） |

### 版本管理

| 功能         | 方法   | 路径                                 | 描述               |
| :----------- | :----- | :----------------------------------- | :----------------- |
| 获取版本历史 | GET    | /{note_id}/versions                  | 获取笔记的版本历史 |
| 获取特定版本 | GET    | /{note_id}/versions/{version_number} | 获取笔记的特定版本 |
| 恢复版本     | POST   | /{note_id}/versions/restore          | 恢复笔记到指定版本 |
| 比较版本     | POST   | /{note_id}/versions/compare          | 比较两个版本的差异 |
| 清理旧版本   | DELETE | /{note_id}/versions/cleanup          | 清理旧版本         |

## 🤖 AI代理 (/api/v1/agents)

| 功能           | 方法 | 路径                | 描述                         |
| :------------- | :--- | :------------------ | :--------------------------- |
| 获取代理列表   | GET  | /                   | 获取可用的AI代理列表         |
| 获取代理详情   | GET  | /{agent_id}         | 获取特定代理的详细信息       |
| 执行代理       | POST | /{agent_id}/execute | 执行AI代理任务               |
| 创建自定义代理 | POST | /                   | 创建自定义AI代理（高级功能） |
| 深度研究       | POST | /deep-research      | 创建深度研究任务             |

## 📤 导出功能 (/api/v1/export)

| 功能     | 方法 | 路径           | 描述                    |
| :------- | :--- | :------------- | :---------------------- |
| 导出笔记 | POST | /notes         | 导出笔记为PDF/DOCX格式  |
| 导出文档 | POST | /documents     | 导出文档为指定格式      |
| 导出空间 | POST | /space         | 导出整个空间的内容      |
| 导出对话 | POST | /conversations | 导出对话为JSON/Markdown |

## 📌 标注管理 (/api/v1/annotations)

### 标注CRUD

| 功能         | 方法   | 路径                                      | 描述                   |
| :----------- | :----- | :---------------------------------------- | :--------------------- |
| 获取文档标注 | GET    | /document/{document_id}                   | 获取文档的标注列表     |
| 按页获取标注 | GET    | /document/{document_id}/pages             | 获取指定页码范围的标注 |
| PDF页面标注  | GET    | /document/{document_id}/pdf/{page_number} | 获取PDF特定页的标注    |
| 获取我的标注 | GET    | /my                                       | 获取用户的所有标注     |
| 标注统计     | GET    | /statistics                               | 获取标注统计信息       |
| 获取标注详情 | GET    | /{annotation_id}                          | 获取标注详细信息       |
| 创建标注     | POST   | /                                         | 创建新标注             |
| 批量创建标注 | POST   | /batch                                    | 批量创建标注           |
| PDF批量标注  | POST   | /pdf/batch                                | 批量创建PDF标注        |
| 更新标注     | PUT    | /{annotation_id}                          | 更新标注信息           |
| 删除标注     | DELETE | /{annotation_id}                          | 删除标注               |

### 标注功能

| 功能     | 方法 | 路径    | 描述                 |
| :------- | :--- | :------ | :------------------- |
| 导出标注 | POST | /export | 导出标注数据         |
| 复制标注 | POST | /copy   | 复制标注到另一个文档 |

## 📖 引用管理 (/api/v1/citations)

### 引用CRUD

| 功能         | 方法   | 路径           | 描述             |
| :----------- | :----- | :------------- | :--------------- |
| 获取引用列表 | GET    | /              | 获取引用列表     |
| 获取引用详情 | GET    | /{citation_id} | 获取引用详细信息 |
| 创建引用     | POST   | /              | 创建新引用       |
| 更新引用     | PUT    | /{citation_id} | 更新引用信息     |
| 删除引用     | DELETE | /{citation_id} | 删除引用         |

### BibTeX功能

| 功能       | 方法 | 路径           | 描述               |
| :--------- | :--- | :------------- | :----------------- |
| 导入BibTeX | POST | /import-bibtex | 导入BibTeX格式引用 |
| 导出引用   | POST | /export        | 导出引用为多种格式 |

### 搜索和格式化

| 功能       | 方法 | 路径    | 描述                     |
| :--------- | :--- | :------ | :----------------------- |
| 搜索引用   | POST | /search | 搜索引用文献             |
| 格式化引用 | POST | /format | 格式化引用（APA、MLA等） |

## 🔧 系统功能

### 健康检查 (/api/v1/health)

| 功能     | 方法 | 路径 | 描述             |
| :------- | :--- | :--- | :--------------- |
| 健康检查 | GET  | /    | 系统健康状态检查 |

### Ollama集成 (/api/v1/ollama)

| 功能           | 方法   | 路径                 | 描述                     |
| :------------- | :----- | :------------------- | :----------------------- |
| 列出Ollama模型 | GET    | /models              | 获取所有可用的Ollama模型 |
| 获取模型信息   | GET    | /models/{model_name} | 获取特定模型的详细信息   |
| 拉取模型       | POST   | /pull                | 拉取新的Ollama模型       |
| 删除模型       | DELETE | /models/{model_name} | 删除Ollama模型           |
| 获取服务状态   | GET    | /status              | 获取Ollama服务状态       |
| 推荐模型       | GET    | /recommended-models  | 获取推荐的模型列表       |

## 🌟 核心技术特性

### 多模态AI支持

- 支持OpenRouter、OpenAI、Claude、Gemini等多种AI模型

- 智能模型路由和自动选择

- 流式和非流式响应支持

- 多模态内容处理（文本、图像、PDF）

### 知识管理

- 向量搜索和语义检索

- 文档智能分析和内容提取

- 空间化知识组织

- 笔记版本控制和协作

### 高级功能

- 深度研究和自动信息收集

- PDF标注和引用管理

- 对话分支和上下文管理

- 多格式导出和数据互操作

### 企业级特性

- JWT认证和权限控制

- 数据备份和版本管理

- API速率限制和使用统计

- 健康监控和系统状态