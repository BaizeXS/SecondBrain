# Second Brain Web 应用项目设计文档

## 1. 项目概述

### 1.1 项目背景

Second Brain Web 应用是一个集成 AI 对话、智能研究助手和个人知识管理的在线平台。该项目从原有的桌面应用转型为 Web 应用，旨在提供更广泛的可访问性和更好的用户体验。

### 1.2 项目愿景

构建一个由 AI 驱动的个人知识管理系统，帮助用户高效地收集、组织、理解和应用知识，成为用户的"第二大脑"。通过 AI 技术的深度应用，让每个人都能够更高效地获取和整理知识、更深入地理解和关联信息、更智能地应用和创造价值。

### 1.3 核心价值

- **智能化知识管理**：通过 AI 技术自动整理、关联和提取知识，不仅存储数据，更鼓励内容的标注、归纳、总结和扩展
- **深度研究辅助**：自动化信息收集和分析，提升研究效率，一键启动全流程研究
- **交互式学习体验**：结合文档管理和 AI 对话，实现边学边问，精确到页码和段落的智能问答
- **知识自动关联**：AI 自动发现和构建知识联系，形成完整的认知网络

### 1.4 目标用户

- **学生群体**（18-30 岁）：管理学习资料、提高学习效率、准备考试、学术研究、团队项目协作
- **科研人员**：文献管理、研究分析、论文写作、学术交流
- **知识工作者**：信息整理、知识积累、工作效率提升、持续学习

## 2. 功能架构

### 2.1 三大核心模块

#### 2.1.1 AI 对话（Chat）

- 双模式支持：
  - Chat 模式：与 AI 大模型直接对话
    - 支持的模型：OpenAI (GPT-4.1、o4-mini)、Google (Gemini 2.5 Pro/Flash)、Anthropic (Claude 4/3.7 Sonnet)、国产模型 (DeepSeek R1/V3)
    - 本地模型支持：通过 Ollama/LM Studio 接入
    - 特色功能：流式输出、上下文记忆、对话分支管理、一键重新生成、导出功能
  - Search 模式：通过 Perplexity API 进行联网搜索
    - 可选模型：Sonar Lightweight（快速便宜）、Sonar Pro（高级查询）
    - 特色功能：实时网络检索、来源链接展示、信息可信度标注、关键信息高亮
- 界面设计：
  - 顶部工具栏：新建对话、对话历史、更多选项
  - 对话区域：消息气泡、Markdown 渲染、代码高亮、数学公式、图片预览
  - 输入控制：模式切换、模型选择、多行输入、快捷键支持

#### 2.1.2 智能代理（Agents）

- Deep Research 代理（初期重点）：
  - 基于 Perplexity Deep Research API
  - 自动创建主题 Space 并保存相关文献
  - 支持通用模式和学术模式
- 补充：初期使用 Perplexity 提供的 Deep Research API，第二个版本的时候，基于 Google 开源项目参考 Google Gemini Fullstack LangGraph Quickstart 改造成支持多家 API 的 Deep Research Agent
- **扩展计划**：后续可添加 AI PPT 生成、代码助手、写作助手等

**Agent 系统设计架构**：
- **官方 Agent**（user_id = NULL）：
  - Prompt Agent：预设提示词的简单代理（如写作助手、翻译助手）
  - LangGraph Agent（未来）：基于 LangGraph 的复杂多步骤代理，支持工具调用
- **用户自定义 Agent**（user_id = 用户ID）：
  - 用户可创建自己的 Prompt Agent
  - 通过 agent_type 字段区分类型（research/analysis/custom 等）
  - config 字段灵活存储配置（Prompt Agent 存简单配置，LangGraph Agent 存复杂图定义）
- **设计优势**：向后兼容，便于未来扩展

#### 2.1.3 知识库（Space）

- **多 Space 管理**：用户可创建多个独立的知识空间，支持分类管理
- 文件支持：
  - 文档：PDF、Word、PPT、Excel
  - 文本：Markdown、TXT、代码文件
  - 图片：JPG、PNG、GIF
  - 网页：URL 链接、网页快照
  - 学术：BibTeX 引用文件
- **智能对话**：在 Space 内与 AI 对话，引用多个文件提高准确性
- **笔记功能**：Markdown 格式笔记，支持实时编辑、版本历史、导出分享

### 2.2 界面布局设计

#### 2.2.1 主界面

```
┌─────────────┬────────────────────────────────┐
│   侧边栏    │          主内容区              │
├─────────────┤                                │
│ 💬 聊天     │                                │
│ 🤖 Agents   │      根据选择展示不同内容      │
│   └ Deep    │                                │
│     Research│                                │
│ 📁 Space    │                                │
│   └ 暂存箱 │                                │
│   └ 项目1  │                                │
│   └ 项目2  │                                │
└─────────────┴────────────────────────────────┘
```

#### 2.2.2 Deep Research 入口界面

```
┌────────────────────────────────────────────────┐
│              Deep Research (Beta)               │
│                                                │
│             [通用]     [学术]                   │
│                                                │
│        ┌──────────────────────────┐            │
│        │                          │            │
│        │   您今天想研究什么？     │            │
│        │                          │            │
│        └──────────────────────────┘            │
│                                                │
│
│                                                │
└────────────────────────────────────────────────┘
```

#### 2.2.3 聊天界面

```
┌────────────────────────────────────────────────┐
│  你好，                                        │
│  我今天能帮你什么？                            │
│                                                │
│                                                │
│ ┌────────────────────────────────────────┐    │
│ │  询问AI任何问题...                       │    │
│ │                                        │    │
│ └────────────────────────────────────────┘    │
│  [○ Chat] [○ Search]  [DeepSeek ▼]  [发送]    │
│                                                │
│                                                │
│                                                │
│                                                │
└────────────────────────────────────────────────┘
```

#### 2.2.4 Space 列表界面

```
┌────────────────────────────────────────────────┐
│        欢迎来到Second Brain Space              │
│                                                │
│  Space是一个由AI驱动的知识库，简化了您从...    │
│                                                │
│        [+ 创建Space]                           │
│                                                │
│  ┌─────────────┐  ┌─────────────┐            │
│  │     📁      │  │     📁      │            │
│  │             │  │             │            │
│  │ 灾难性遗忘     │ 研究项目2   │            │
│  │             │  │             │            │
│  │ 2025年5月23日│  │ 2025年5月20日│          │
│  └─────────────┘  └─────────────┘            │
│                                                │
└────────────────────────────────────────────────┘
```

#### 2.2.5 Space 详情页（AI 对话增强模式）

```
┌─────────┬─────────────────┬──────────────┐
│  文件   │    AI对话区     │    笔记区    │
│  列表   │                 │              │
│         │  今天我能为你   │  Notes │
│ ☑文件1  │  提供什么帮助？ │              │
│ ☑文件2  │                 │  笔记(22)    │
│ ☐文件3  │   │              │
│         │                 │  +添加笔记   │
│ 选择来源│  [DeepSeek ▼]   │              │
│ (全部)  │                 │  ·因果追踪  │
│         │  [询问AI...]    │  ·笔记2     │
│ +添加文件│                │  ·笔记3     │
└─────────┴─────────────────┴──────────────┘
```

#### 2.2.6 文档预览界面

```
┌─────────┬─────────────────┬──────────────┐
│ 文件列表│   PDF文档预览    │  AI聊天/笔记│
│         │                 │              │
│ ☉文件1  │ ┌─────────────┐ │             │
│ ○文件2  │ │             │ │              │
│ ○文件3  │ │  论文内容   │ │              │
│         │ │             │ │             │
│ 选择来源│ │  [AI助手]   │ │              │
│ (1)     │ │             │ │            │
│         │ └─────────────┘ │            │
│ +添加   │                 │             │
│         │ [全文翻译][下载]│              │
└─────────┴─────────────────┴──────────────┘
```

## 3. 详细功能说明

### 3.1 聊天功能

- 界面元素：
  - 模型选择器（下拉菜单）- 显示所有可用模型
  - 模式切换按钮（Chat/Search）- 明显的切换标识
  - 消息输入框 - 支持多行输入、粘贴图片
  - 对话历史显示区 - 时间戳、模型标识
- 功能特性：
  - 实时流式响应 - 逐字显示，提升体验
  - 代码高亮显示 - 支持多种编程语言
  - 引用来源标注（Search 模式）- 可点击跳转
  - 数学公式渲染 - LaTeX 支持
  - 图片内容理解 - 支持图片上传分析

**重要设计理念**：
- AI Chat 页面的对话是**独立的**，不与任何 Space 关联
- 这些对话类似于搜索引擎，用于快速获取信息和概念理解
- 只有在 Space 内创建的对话或通过 Deep Research 创建的对话才会关联到特定 Space
- 技术实现：Conversation 表的 space_id 字段可为空（NULL），AI Chat 页面的对话该字段为 NULL

### 3.2 Deep Research 功能

#### 3.2.1 入口界面设计

- 页面布局：
  - 中心大标题："Deep Research (Beta)"
  - 副标题说明："您今天想研究什么？"
  - 模式选择标签：通用 | 学术
  - 中央输入框：支持中英文，回车触发
  - 底部说明文字

#### 3.2.2 工作流程

1. 用户选择研究模式（通用/学术）
2. 输入研究主题并回车
3. 显示研究进度界面
4. 系统调用 Deep Research API
5. 自动创建主题 Space
6. 收集相关文献和资料
7. 整理并保存至 Space
8. 研究完成后自动跳转

#### 3.2.3 研究模式对比

- 通用模式：
  - 信息源：网络搜索、新闻、博客、社交媒体
  - 适用场景：市场调研、技术趋势、热点分析
  - 结果特点：时效性强、覆盖面广、易于理解
- 学术模式：
  - 信息源：学术数据库、期刊论文、会议文献、预印本
  - 适用场景：文献综述、理论研究、学术写作
  - 结果特点：权威性高、引用完整、理论深度

### 3.3 Space 管理

#### 3.3.1 Space 列表页

- 界面设计：
  - 顶部欢迎语："欢迎来到 Second Brain"
  - "+"创建新 Space 按钮
  - Space 卡片网格布局
  - 每个卡片显示：图标、名称、更新时间、文件数
- 交互功能：
  - 点击进入 Space
  - 右键菜单：重命名、删除、复制
  - 拖拽排序
  - 搜索过滤

#### 3.3.2 Space 详情页 - AI 对话增强模式

- 三栏布局：
  - 左栏 - 文件管理：
    - 文件列表展示
    - 复选框多选
    - 添加文件按钮
    - 文件搜索
    - 已选计数器
  - 中栏 - AI 对话：
    - 模型选择器
    - 对话消息流
    - 文件引用标注
    - 快捷操作按钮
    - 输入区域
  - 右栏 - 笔记管理：
    - Files|Notes 标签切换
    - 笔记列表
    - 添加笔记按钮
    - 笔记预览
    - 快速编辑

#### 3.3.3 文档预览模式

- 界面布局：
  - 左栏保持文件列表
  - 中间为文档查看器（PDF 渲染、缩放控制、页面导航）
  - 右栏切换为标注和笔记功能
- PDF 专属功能：
  - 高亮标注（5 种颜色）
  - 下划线和批注
  - 区域框选
  - AI 辅助（选中翻译、术语解释、段落总结）

### 3.4 笔记系统

#### 3.4.1 笔记类型

- **手动笔记**：用户创建和编辑
- **AI 笔记**：自动生成的总结、要点、问答记录
- **关联笔记**：与特定文件或段落关联

#### 3.4.2 Markdown 编辑器功能

- 实时预览
- 快捷工具栏
- LaTeX 公式支持
- Mermaid 图表
- 表格编辑器
- 代码高亮
- 图片上传

#### 3.4.3 笔记管理

- 标签分类系统
- 全文搜索
- 版本历史记录
- 多格式导出（MD/PDF/HTML）
- 分享链接生成

### 3.5 文件管理功能

#### 3.5.1 上传方式

- 拖拽上传（支持批量）
- 点击选择上传
- 剪贴板粘贴
- URL 导入
- 文件夹上传

#### 3.5.2 文件操作

- 重命名、移动、复制
- 批量操作
- 标签管理
- 跨 Space 转移
- 文件夹组织

#### 3.5.3 智能功能

- 全文搜索（OCR 支持）
- 相似文件检测
- 智能分类建议
- 自动元数据提取

## 4. 技术架构

### 4.1 前端技术栈

- **框架**：React
- **状态管理**：Zustand
- Markdown 编辑器
- **文件预览**：PDF.js、react-file-viewer
- **代码编辑**：Monaco Editor

### 4.2 后端技术栈

- **Web 框架**：FastAPI
- **数据库**：PostgreSQL
- **缓存**：Redis
- **文件存储**：MinIO / 本地存储
- **容器化**：Docker Compose
- **包管理**：uv

### 4.3 API 集成

- AI 模型 API：
  - OpenAI API
  - Google Gemini API
  - Anthropic Claude API
  - Deepseek API
  - 本地模型（Ollama）
- 搜索 API：
  - Perplexity API (Search & Deep Research)

## 5. 数据模型设计

### 5.1 核心实体

```python
# 用户
User {
  id: UUID
  email: string
  username: string
  created_at: datetime
  preferences: JSON  # 用户偏好设置
}

# Space
Space {
  id: UUID
  user_id: UUID
  title: string
  description: string
  type: string  # normal/research
  created_at: datetime
  updated_at: datetime
  metadata: JSON  # 额外信息
}

# 文件
File {
  id: UUID
  space_id: UUID
  filename: string
  file_type: string
  file_path: string
  file_size: integer
  uploaded_at: datetime
  metadata: JSON  # OCR文本、标签等
}

# 对话记录
Conversation {
  id: UUID
  space_id: UUID
  user_id: UUID
  model: string
  mode: string  # chat/search
  messages: JSON
  created_at: datetime
  title: string  # 对话标题
}

# 笔记
Note {
  id: UUID
  space_id: UUID
  title: string
  content: text (Markdown)
  type: string  # manual/ai/linked
  file_refs: JSON  # 关联文件
  created_at: datetime
  updated_at: datetime
  tags: JSON
}

# 标注
Annotation {
  id: UUID
  file_id: UUID
  user_id: UUID
  type: string  # highlight/underline/note
  color: string
  content: text
  position: JSON  # 页码、坐标等
  created_at: datetime
}
```

## 6. 使用场景与工作流

### 6.1 学术研究场景

**场景描述**：研究生进行文献综述

1. 使用 Deep Research 学术模式搜索研究主题
2. 系统自动创建 Space 并收集相关论文
3. 上传导师推荐的补充文献
4. 勾选核心论文进行对比分析
5. AI 精确定位并分析各论文方法论
6. 添加标注和个人见解
7. 生成文献综述大纲
8. 导出整理后的研究报告

### 6.2 课程学习场景

**场景描述**：大学生期末复习

1. 创建课程专属 Space
2. 上传所有课件、教材、作业
3. 定期添加课堂笔记
4. 考前勾选所有资料让 AI 生成复习大纲
5. 针对薄弱知识点深入提问
6. 生成练习题自测
7. 制作知识卡片强化记忆

### 6.3 工作研究场景

**场景描述**：产品经理市场调研

1. 使用 Deep Research 通用模式研究市场趋势
2. 收集竞品信息和行业报告
3. 上传内部数据和用户反馈
4. 与 AI 对话分析竞争优势
5. 生成 SWOT 分析
6. 制作市场分析报告
7. 导出 PPT 素材分享团队

## 7. 简化实现策略

### 7.1 技术简化

- 使用成熟的 UI 组件库，避免自定义复杂组件
- 优先使用第三方服务（如文件预览），减少自研
- 采用简单的文件存储方案，暂不考虑分布式存储
- 使用现成的 Markdown 编辑器组件

### 7.2 功能简化

- 初期仅支持单用户或简单的用户系统
- Deep Research 先实现基础版本，后续迭代优化
- 文件预览仅支持常见格式（PDF、TXT、MD）
- 暂不实现实时协作功能

### 7.3 部署简化

- 使用 Docker Compose 一键部署
- 提供详细的部署文档
- 支持主流云服务商（阿里云、腾讯云）
- 提供演示环境供测试

## 8. 项目亮点与差异化

### 8.1 核心创新

- **深度研究自动化**：一键启动全流程研究，自动整理知识体系
- **文件级 AI 对话**：精确到页码和段落的智能问答，不是简单的文档问答
- **知识自动关联**：AI 自动发现和构建知识联系，形成知识网络
- **学习全流程支持**：从资料收集到知识输出的完整闭环

### 8.2 差异化优势

- **专注知识管理**：不是通用笔记工具，而是智能知识系统
- **AI 深度集成**：不是简单的 AI 问答，而是贯穿全流程的智能辅助
- **学术研究友好**：专门优化的学术模式和引用管理
- **简洁高效**：面向大学生的轻量级设计，快速上手

### 8.3 技术亮点

- **现代化技术栈**：采用最新的 Web 技术，保证良好的开发体验
- **模块化设计**：便于功能扩展和维护
- **容器化部署**：简化部署流程，提高可移植性
- **AI 模型灵活**：支持多种 AI 模型，满足不同需求

## 9. 未来展望

### 9.1 功能扩展

- **更多 Agent**：AI PPT 生成器、代码助手、写作助手
- **协作功能**：团队 Space、实时协同编辑、评论系统
- **知识图谱**：可视化知识网络、概念关联图、学习路径
- **移动端应用**：随时随地访问知识库

### 9.2 产品愿景

Second Brain 不仅是一个工具，更是用户的智能知识伙伴。通过 AI 技术的深度应用，实现"让知识管理变得简单而智能"的产品使命，帮助每个人构建属于自己的第二大脑。
